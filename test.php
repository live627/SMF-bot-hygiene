<?php

/**
 * Simple CLI test for cidr_list_cleaner.php using the three real-world examples
 * provided in your message.  The test writes a temporary input file for each
 * example, runs the CIDR_list constructor, collects the cleaned results and
 * compares them (order-insensitive) to the expected cleaned CIDRs.
 *
 * Usage:
 *   php test
 */

require_once __DIR__ . '/cidr_list_cleaner.php';

function run_test($name, array $input_lines, array $expected_lines)
{
	$tmp = __DIR__ . '/cidr_test_' . uniqid();
	file_put_contents($tmp, implode("\n", $input_lines) . "\n");

	$list = new CIDR_list($tmp);

	$out_lines = [];
	foreach ($list->cidrs_ipv4 as $c) {
		$out_lines[] = $c->to_text();
	}
	foreach ($list->cidrs_ipv6 as $c) {
		$out_lines[] = $c->to_text();
	}

	// normalize ordering for comparison
	sort($out_lines);
	sort($expected_lines);

	$ok = ($out_lines === $expected_lines);

	echo "Test: $name - " . ($ok ? "PASS" : "FAIL") . PHP_EOL;
	if (!$ok) {
		echo "Expected:\n" . implode("\n", $expected_lines) . "\n\n";
		echo "Got:\n" . implode("\n", $out_lines) . "\n\n";
	}

	unlink($tmp);
	return $ok;
}

/*
 * Example 1 (IPv4) - large ASN lookup list that should reduce to single CIDR
 * 222.252.0.0 - 222.255.255.255 => 222.252.0.0/14
 */
$example1 = [
	"222.252.0.0/16",
	"222.252.16.0/20",
	"222.252.32.0/20",
	"222.252.48.0/20",
	"222.252.64.0/18",
	"222.252.80.0/20",
	"222.252.96.0/20",
	"222.252.112.0/20",
	"222.252.128.0/18",
	"222.252.144.0/20",
	"222.252.160.0/20",
	"222.252.176.0/20",
	"222.252.192.0/18",
	"222.252.194.0/23",
	"222.252.204.0/24",
	"222.252.208.0/20",
	"222.252.210.0/24",
	"222.252.216.0/24",
	"222.252.223.0/24",
	"222.252.224.0/20",
	"222.252.240.0/20",
	"222.252.250.0/23",
	"222.253.0.0/16",
	"222.253.8.0/21",
	"222.253.10.0/23",
	"222.253.16.0/20",
	"222.253.24.0/21",
	"222.253.32.0/20",
	"222.253.40.0/21",
	"222.253.48.0/20",
	"222.253.56.0/21",
	"222.253.64.0/18",
	"222.253.72.0/21",
	"222.253.80.0/20",
	"222.253.88.0/21",
	"222.253.95.0/24",
	"222.253.96.0/20",
	"222.253.97.0/24",
	"222.253.98.0/24",
	"222.253.99.0/24",
	"222.253.104.0/21",
	"222.253.112.0/20",
	"222.253.120.0/21",
	"222.253.128.0/18",
	"222.253.136.0/21",
	"222.253.144.0/20",
	"222.253.152.0/21",
	"222.253.160.0/20",
	"222.253.168.0/21",
	"222.253.176.0/20",
	"222.253.184.0/21",
	"222.253.192.0/18",
	"222.253.200.0/21",
	"222.253.207.0/24",
	"222.253.208.0/20",
	"222.253.216.0/21",
	"222.253.224.0/20",
	"222.253.230.0/24",
	"222.253.231.0/24",
	"222.253.232.0/21",
	"222.253.240.0/20",
	"222.253.248.0/21",
	"222.253.254.0/23",
	"222.254.0.0/16",
	"222.254.16.0/20",
	"222.254.32.0/20",
	"222.254.48.0/20",
	"222.254.64.0/18",
	"222.254.80.0/20",
	"222.254.96.0/20",
	"222.254.104.0/21",
	"222.254.112.0/20",
	"222.254.128.0/18",
	"222.254.144.0/20",
	"222.254.160.0/20",
	"222.254.176.0/20",
	"222.254.184.0/24",
	"222.254.185.0/24",
	"222.254.186.0/24",
	"222.254.187.0/24",
	"222.254.188.0/24",
	"222.254.189.0/24",
	"222.254.190.0/24",
	"222.254.191.0/24",
	"222.254.192.0/18",
	"222.254.208.0/20",
	"222.254.224.0/20",
	"222.254.240.0/20",
	"222.255.0.0/16",
	"222.255.1.0/24",
	"222.255.2.0/23",
	"222.255.4.0/23",
	"222.255.6.0/23",
	"222.255.8.0/21",
	"222.255.9.0/24",
	"222.255.10.0/23",
	"222.255.16.0/21",
	"222.255.18.0/23",
	"222.255.19.0/24",
	"222.255.20.0/23",
	"222.255.21.0/24",
	"222.255.22.0/23",
	"222.255.24.0/21",
	"222.255.26.0/23",
	"222.255.27.0/24",
	"222.255.28.0/23",
	"222.255.29.0/24",
	"222.255.30.0/23",
	"222.255.32.0/22",
	"222.255.36.0/23",
	"222.255.40.0/21",
	"222.255.41.0/24",
	"222.255.42.0/23",
	"222.255.44.0/23",
	"222.255.46.0/23",
	"222.255.48.0/21",
	"222.255.54.0/23",
	"222.255.56.0/21",
	"222.255.60.0/23",
	"222.255.64.0/21",
	"222.255.66.0/23",
	"222.255.68.0/23",
	"222.255.70.0/23",
	"222.255.72.0/21",
	"222.255.74.0/23",
	"222.255.76.0/23",
	"222.255.78.0/23",
	"222.255.80.0/21",
	"222.255.82.0/23",
	"222.255.84.0/23",
	"222.255.86.0/23",
	"222.255.88.0/21",
	"222.255.90.0/23",
	"222.255.94.0/23",
	"222.255.96.0/22",
	"222.255.100.0/23",
	"222.255.104.0/21",
	"222.255.112.0/21",
	"222.255.113.0/24",
	"222.255.114.0/23",
	"222.255.115.0/24",
	"222.255.116.0/23",
	"222.255.117.0/24",
	"222.255.118.0/24",
	"222.255.119.0/24",
	"222.255.120.0/21",
	"222.255.124.0/23",
	"222.255.128.0/21",
	"222.255.130.0/23",
	"222.255.132.0/23",
	"222.255.134.0/23",
	"222.255.136.0/21",
	"222.255.138.0/23",
	"222.255.140.0/23",
	"222.255.144.0/21",
	"222.255.146.0/23",
	"222.255.148.0/23",
	"222.255.150.0/23",
	"222.255.152.0/21",
	"222.255.154.0/23",
	"222.255.156.0/23",
	"222.255.158.0/23",
	"222.255.160.0/21",
	"222.255.166.0/23",
	"222.255.167.0/24",
	"222.255.168.0/21",
	"222.255.169.0/24",
	"222.255.170.0/23",
	"222.255.172.0/23",
	"222.255.173.0/24",
	"222.255.174.0/23",
	"222.255.175.0/24",
	"222.255.176.0/21",
	"222.255.177.0/24",
	"222.255.178.0/23",
	"222.255.179.0/24",
	"222.255.180.0/23",
	"222.255.181.0/24",
	"222.255.182.0/23",
	"222.255.183.0/24",
	"222.255.184.0/21",
	"222.255.192.0/21",
	"222.255.196.0/23",
	"222.255.198.0/23",
	"222.255.200.0/21",
	"222.255.202.0/23",
	"222.255.204.0/23",
	"222.255.206.0/23",
	"222.255.208.0/23",
	"222.255.212.0/22",
	"222.255.213.0/24",
	"222.255.214.0/24",
	"222.255.215.0/24",
	"222.255.216.0/21",
	"222.255.217.0/24",
	"222.255.218.0/23",
	"222.255.220.0/23",
	"222.255.222.0/23",
	"222.255.224.0/21",
	"222.255.226.0/23",
	"222.255.232.0/23",
	"222.255.236.0/24",
	"222.255.238.0/24",
	"222.255.240.0/21",
	"222.255.248.0/21",
	"222.255.250.0/23",
	"222.255.252.0/23",
];

$expected1 = ["222.252.0.0/14"];

/*
 * Example 2 (IPv4) - large ASN lookup that should reduce to four high-level CIDRs
 * For the test we include a representative (but still sizeable) subset from the
 * message. The algorithm should combine these into the expected broader CIDRs.
 */
$example2 = [
	"14.226.0.0/16",
	"14.226.8.0/21",
	"14.226.16.0/20",
	"14.226.24.0/21",
	"14.226.32.0/20",
	"14.226.40.0/21",
	"14.226.48.0/20",
	"14.226.56.0/21",
	"14.226.64.0/18",
	"14.226.72.0/21",
	"14.226.80.0/20",
	"14.226.88.0/21",
	"14.226.96.0/20",
	"14.226.104.0/21",
	"14.226.112.0/20",
	"14.226.120.0/21",
	"14.226.128.0/18",
	"14.226.136.0/21",
	"14.226.144.0/20",
	"14.226.152.0/21",
	"14.226.160.0/20",
	"14.226.168.0/21",
	"14.226.174.0/24",
	"14.226.176.0/20",
	"14.226.184.0/21",
	"14.226.192.0/18",
	"14.226.200.0/21",
	"14.226.208.0/20",
	"14.226.216.0/21",
	"14.226.224.0/20",
	"14.226.232.0/21",
	"14.226.240.0/20",
	"14.226.248.0/21",
	"14.227.0.0/16",
	"14.227.16.0/20",
	"14.227.32.0/20",
	"14.227.48.0/20",
	"14.227.64.0/18",
	"14.227.80.0/20",
	"14.227.96.0/20",
	"14.227.112.0/20",
	"14.227.128.0/18",
	"14.227.144.0/20",
	"14.227.160.0/20",
	"14.227.176.0/20",
	"14.227.192.0/18",
	"14.227.208.0/20",
	"14.227.224.0/20",
	"14.228.0.0/16",
	"14.228.8.0/21",
	"14.228.16.0/21",
	"14.228.24.0/21",
	"14.228.32.0/21",
	"14.228.40.0/21",
	"14.228.48.0/21",
	"14.228.56.0/21",
	"14.228.64.0/18",
	"14.228.72.0/21",
	"14.228.80.0/21",
	"14.228.88.0/21",
	"14.228.96.0/21",
	"14.228.104.0/21",
	"14.228.112.0/21",
	"14.228.120.0/21",
	"14.228.128.0/18",
	"14.228.136.0/21",
	"14.228.144.0/21",
	"14.228.152.0/21",
	"14.228.160.0/21",
	"14.228.168.0/21",
	"14.228.176.0/21",
	"14.228.184.0/21",
	"14.228.192.0/18",
	"14.228.200.0/21",
	"14.228.208.0/21",
	"14.228.216.0/21",
	"14.228.224.0/21",
	"14.228.232.0/21",
	"14.228.240.0/21",
	"14.228.248.0/21",
	"14.229.0.0/16",
	"14.229.16.0/20",
	"14.229.32.0/20",
	"14.229.48.0/20",
	"14.229.64.0/18",
	"14.229.76.0/23",
	"14.229.80.0/20",
	"14.229.90.0/23",
	"14.229.96.0/20",
	"14.229.112.0/20",
	"14.229.128.0/18",
	"14.229.144.0/20",
	"14.229.158.0/23",
	"14.229.160.0/20",
	"14.229.176.0/20",
	"14.229.192.0/18",
	"14.229.208.0/20",
	"14.229.224.0/20",
	"14.229.240.0/20",
	"14.230.0.0/16",
	"14.230.16.0/20",
	"14.230.32.0/20",
	"14.230.48.0/20",
	"14.230.64.0/18",
	"14.230.80.0/20",
	"14.230.96.0/20",
	"14.230.112.0/20",
	"14.230.128.0/18",
	"14.230.144.0/20",
	"14.230.160.0/20",
	"14.230.176.0/20",
	"14.230.192.0/18",
	"14.230.208.0/20",
	"14.230.224.0/20",
	"14.230.240.0/20",
	"14.231.0.0/16",
	"14.231.16.0/20",
	"14.231.32.0/20",
	"14.231.48.0/20",
	"14.231.64.0/18",
	"14.231.80.0/20",
	"14.231.96.0/20",
	"14.231.112.0/20",
	"14.231.128.0/18",
	"14.231.144.0/20",
	"14.231.160.0/20",
	"14.231.176.0/20",
	"14.231.192.0/18",
	"14.231.208.0/20",
	"14.231.224.0/20",
	"14.231.240.0/20",
	"14.232.0.0/16",
	"14.232.16.0/20",
	"14.232.32.0/20",
	"14.232.48.0/20",
	"14.232.64.0/18",
	"14.232.80.0/20",
	"14.232.96.0/20",
	"14.232.112.0/20",
	"14.232.128.0/18",
	"14.232.144.0/20",
	"14.232.160.0/20",
	"14.232.176.0/20",
	"14.232.192.0/18",
	"14.232.208.0/20",
	"14.232.224.0/20",
	"14.232.232.0/21",
	"14.232.240.0/20",
	"14.232.252.0/22",
	"14.233.0.0/16",
	"14.233.16.0/20",
	"14.233.32.0/20",
	"14.233.48.0/20",
	"14.233.64.0/18",
	"14.233.80.0/20",
	"14.233.96.0/20",
	"14.233.112.0/20",
	"14.233.128.0/18",
	"14.233.144.0/20",
	"14.233.160.0/20",
	"14.233.176.0/20",
	"14.233.192.0/18",
	"14.233.208.0/20",
	"14.233.224.0/20",
	"14.233.240.0/20",
	"14.234.0.0/16",
	"14.234.16.0/20",
	"14.234.32.0/20",
	"14.234.48.0/20",
	"14.234.64.0/18",
	"14.234.80.0/20",
	"14.234.96.0/20",
	"14.234.112.0/20",
	"14.234.128.0/18",
	"14.234.144.0/20",
	"14.234.160.0/20",
	"14.234.176.0/20",
	"14.234.192.0/18",
	"14.234.208.0/20",
	"14.234.224.0/20",
	"14.234.240.0/20",
	"14.235.0.0/16",
	"14.235.16.0/20",
	"14.235.32.0/20",
	"14.235.48.0/20",
	"14.235.64.0/18",
	"14.235.80.0/20",
	"14.235.96.0/20",
	"14.235.112.0/20",
	"14.235.128.0/18",
	"14.235.144.0/20",
	"14.235.160.0/20",
	"14.235.176.0/20",
	"14.235.192.0/18",
	"14.235.208.0/20",
	"14.235.224.0/20",
	"14.235.240.0/20",
	"14.236.0.0/16",
	"14.236.16.0/20",
	"14.236.32.0/20",
	"14.236.48.0/20",
	"14.236.64.0/18",
	"14.236.80.0/20",
	"14.236.96.0/20",
	"14.236.112.0/20",
	"14.236.128.0/18",
	"14.236.144.0/20",
	"14.236.160.0/20",
	"14.236.176.0/20",
	"14.236.192.0/18",
	"14.236.208.0/20",
	"14.236.224.0/20",
	"14.236.240.0/20",
	"14.237.0.0/16",
	"14.237.16.0/20",
	"14.237.32.0/20",
	"14.237.48.0/20",
	"14.237.64.0/18",
	"14.237.80.0/20",
	"14.237.96.0/20",
	"14.237.112.0/20",
	"14.237.128.0/18",
	"14.237.144.0/20",
	"14.237.160.0/20",
	"14.237.176.0/20",
	"14.237.192.0/18",
	"14.237.208.0/20",
	"14.237.224.0/20",
	"14.237.240.0/20",
	"14.238.0.0/16",
	"14.238.1.0/24",
	"14.238.2.0/24",
	"14.238.3.0/24",
	"14.238.4.0/24",
	"14.238.5.0/24",
	"14.238.6.0/24",
	"14.238.7.0/24",
	"14.238.8.0/24",
	"14.238.9.0/24",
	"14.238.10.0/24",
	"14.238.11.0/24",
	"14.238.12.0/24",
	"14.238.13.0/24",
	"14.238.14.0/24",
	"14.238.15.0/24",
	"14.238.16.0/20",
	"14.238.17.0/24",
	"14.238.18.0/24",
	"14.238.19.0/24",
	"14.238.20.0/24",
	"14.238.21.0/24",
	"14.238.22.0/24",
	"14.238.23.0/24",
	"14.238.24.0/24",
	"14.238.25.0/24",
	"14.238.26.0/24",
	"14.238.27.0/24",
	"14.238.28.0/24",
	"14.238.29.0/24",
	"14.238.30.0/24",
	"14.238.32.0/20",
	"14.238.33.0/24",
	"14.238.34.0/24",
	"14.238.35.0/24",
	"14.238.36.0/24",
	"14.238.37.0/24",
	"14.238.38.0/24",
	"14.238.39.0/24",
	"14.238.40.0/24",
	"14.238.41.0/24",
	"14.238.42.0/24",
	"14.238.43.0/24",
	"14.238.44.0/24",
	"14.238.45.0/24",
	"14.238.46.0/24",
	"14.238.47.0/24",
	"14.238.48.0/20",
	"14.238.60.0/24",
	"14.238.64.0/18",
	"14.238.80.0/20",
	"14.238.81.0/24",
	"14.238.82.0/24",
	"14.238.83.0/24",
	"14.238.84.0/24",
	"14.238.85.0/24",
	"14.238.86.0/24",
	"14.238.87.0/24",
	"14.238.88.0/24",
	"14.238.89.0/24",
	"14.238.90.0/24",
	"14.238.91.0/24",
	"14.238.92.0/24",
	"14.238.93.0/24",
	"14.238.94.0/24",
	"14.238.95.0/24",
	"14.238.96.0/20",
	"14.238.97.0/24",
	"14.238.98.0/24",
	"14.238.99.0/24",
	"14.238.100.0/24",
	"14.238.101.0/24",
	"14.238.102.0/24",
	"14.238.103.0/24",
	"14.238.104.0/24",
	"14.238.105.0/24",
	"14.238.106.0/24",
	"14.238.107.0/24",
	"14.238.108.0/24",
	"14.238.109.0/24",
	"14.238.110.0/24",
	"14.238.111.0/24",
	"14.238.112.0/20",
	"14.238.116.0/24",
	"14.238.117.0/24",
	"14.238.128.0/20",
	"14.238.129.0/24",
	"14.238.130.0/23",
	"14.238.133.0/24",
	"14.238.134.0/24",
	"14.238.135.0/24",
	"14.238.137.0/24",
	"14.238.139.0/24",
	"14.238.142.0/24",
	"14.238.224.0/20",
	"14.238.228.0/23",
	"14.238.234.0/23",
	"14.238.240.0/20",
	"14.238.248.0/23",
	"14.238.253.0/24",
	"14.238.255.0/24",
	"14.239.0.0/16",
	"14.239.16.0/20",
	"14.239.32.0/20",
	"14.239.48.0/20",
	"14.239.64.0/18",
	"14.239.80.0/20",
	"14.239.96.0/20",
	"14.239.112.0/20",
	"14.239.128.0/18",
	"14.239.144.0/20",
	"14.239.160.0/20",
	"14.239.176.0/20",
	"14.239.192.0/18",
	"14.239.208.0/20",
	"14.239.224.0/20",
	"14.239.240.0/20",
	"14.240.0.0/16",
	"14.240.16.0/20",
	"14.240.32.0/20",
	"14.240.48.0/20",
	"14.240.64.0/18",
	"14.240.80.0/20",
	"14.240.96.0/20",
	"14.240.112.0/20",
	"14.240.113.0/24",
	"14.240.128.0/18",
	"14.240.144.0/20",
	"14.240.160.0/20",
	"14.240.176.0/20",
	"14.240.192.0/18",
	"14.240.207.0/24",
	"14.240.208.0/20",
	"14.240.224.0/20",
	"14.240.240.0/20",
	"14.241.0.0/16",
	"14.241.1.0/24",
	"14.241.3.0/24",
	"14.241.8.0/21",
	"14.241.11.0/24",
	"14.241.16.0/20",
	"14.241.24.0/21",
	"14.241.30.0/24",
	"14.241.32.0/20",
	"14.241.33.0/24",
	"14.241.40.0/21",
	"14.241.42.0/24",
	"14.241.48.0/20",
	"14.241.49.0/24",
	"14.241.51.0/24",
	"14.241.54.0/24",
	"14.241.55.0/24",
	"14.241.56.0/21",
	"14.241.58.0/24",
	"14.241.59.0/24",
	"14.241.60.0/24",
	"14.241.61.0/24",
	"14.241.62.0/24",
	"14.241.64.0/18",
	"14.241.65.0/24",
	"14.241.68.0/24",
	"14.241.72.0/21",
	"14.241.74.0/24",
	"14.241.77.0/24",
	"14.241.80.0/20",
	"14.241.87.0/24",
	"14.241.88.0/21",
	"14.241.92.0/24",
	"14.241.96.0/20",
	"14.241.103.0/24",
	"14.241.104.0/21",
	"14.241.106.0/24",
	"14.241.108.0/24",
	"14.241.109.0/24",
	"14.241.112.0/20",
	"14.241.115.0/24",
	"14.241.116.0/24",
	"14.241.118.0/24",
	"14.241.120.0/21",
	"14.241.128.0/18",
	"14.241.130.0/24",
	"14.241.132.0/24",
	"14.241.136.0/21",
	"14.241.144.0/20",
	"14.241.150.0/24",
	"14.241.152.0/21",
	"14.241.160.0/20",
	"14.241.164.0/24",
	"14.241.168.0/21",
	"14.241.174.0/24",
	"14.241.176.0/20",
	"14.241.184.0/21",
	"14.241.189.0/24",
	"14.241.192.0/18",
	"14.241.200.0/21",
	"14.241.208.0/20",
	"14.241.209.0/24",
	"14.241.216.0/21",
	"14.241.224.0/20",
	"14.241.232.0/21",
	"14.241.240.0/20",
	"14.241.248.0/21",
	"14.242.0.0/16",
	"14.242.128.0/18",
	"14.242.144.0/20",
	"14.242.160.0/20",
	"14.242.176.0/20",
	"14.242.192.0/18",
	"14.242.208.0/20",
	"14.242.224.0/20",
	"14.242.240.0/20",
	"14.243.0.0/16",
	"14.243.16.0/20",
	"14.243.32.0/20",
	"14.243.48.0/20",
	"14.243.64.0/18",
	"14.243.80.0/20",
	"14.243.96.0/20",
	"14.243.112.0/20",
	"14.243.128.0/18",
	"14.243.144.0/20",
	"14.243.160.0/20",
	"14.243.176.0/20",
	"14.243.192.0/18",
	"14.243.208.0/20",
	"14.243.224.0/20",
	"14.243.240.0/20",
	"14.244.0.0/16",
	"14.244.16.0/20",
	"14.244.32.0/20",
	"14.244.48.0/20",
	"14.244.64.0/18",
	"14.244.80.0/20",
	"14.244.96.0/20",
	"14.244.112.0/20",
	"14.244.128.0/18",
	"14.244.144.0/20",
	"14.244.160.0/20",
	"14.244.176.0/20",
	"14.244.192.0/18",
	"14.244.208.0/20",
	"14.244.224.0/20",
	"14.244.240.0/20",
	"14.245.0.0/16",
	"14.245.16.0/20",
	"14.245.32.0/20",
	"14.245.48.0/20",
	"14.245.64.0/18",
	"14.245.80.0/20",
	"14.245.96.0/20",
	"14.245.112.0/20",
	"14.245.128.0/18",
	"14.245.144.0/20",
	"14.245.160.0/20",
	"14.245.176.0/20",
	"14.245.192.0/18",
	"14.245.208.0/20",
	"14.245.224.0/20",
	"14.245.240.0/20",
	"14.246.0.0/16",
	"14.246.16.0/20",
	"14.246.32.0/20",
	"14.246.48.0/20",
	"14.246.64.0/18",
	"14.246.96.0/20",
	"14.246.112.0/20",
	"14.246.128.0/18",
	"14.246.144.0/20",
	"14.246.160.0/20",
	"14.246.192.0/18",
	"14.246.208.0/20",
	"14.246.224.0/20",
	"14.246.240.0/20",
	"14.247.0.0/16",
	"14.247.16.0/20",
	"14.247.32.0/20",
	"14.247.48.0/20",
	"14.247.64.0/18",
	"14.247.80.0/20",
	"14.247.96.0/20",
	"14.247.112.0/20",
	"14.247.128.0/18",
	"14.247.144.0/20",
	"14.247.160.0/20",
	"14.247.176.0/20",
	"14.247.192.0/18",
	"14.247.208.0/20",
	"14.247.224.0/20",
	"14.247.240.0/20",
	"14.248.0.0/16",
	"14.248.16.0/20",
	"14.248.32.0/20",
	"14.248.40.0/23",
	"14.248.48.0/20",
	"14.248.64.0/18",
	"14.248.80.0/20",
	"14.248.90.0/23",
	"14.248.96.0/20",
	"14.248.112.0/20",
	"14.248.128.0/18",
	"14.248.144.0/20",
	"14.248.160.0/20",
	"14.248.192.0/18",
	"14.248.208.0/20",
	"14.248.224.0/20",
	"14.249.0.0/16",
	"14.249.16.0/20",
	"14.249.32.0/20",
	"14.249.48.0/20",
	"14.249.64.0/18",
	"14.249.80.0/20",
	"14.249.96.0/20",
	"14.249.112.0/20",
	"14.249.128.0/18",
	"14.249.144.0/20",
	"14.249.160.0/20",
	"14.249.176.0/20",
	"14.249.192.0/18",
	"14.249.208.0/20",
	"14.249.224.0/20",
	"14.249.240.0/20",
	"14.250.0.0/16",
	"14.250.16.0/20",
	"14.251.0.0/16",
	"14.251.2.0/24",
	"14.252.0.0/16",
	"14.252.16.0/20",
	"14.252.32.0/20",
	"14.252.48.0/20",
	"14.252.51.0/24",
	"14.252.64.0/18",
	"14.252.96.0/20",
	"14.252.112.0/20",
	"14.252.128.0/18",
	"14.252.144.0/20",
	"14.252.192.0/18",
	"14.252.240.0/20",
	"14.252.254.0/23",
	"14.253.0.0/16",
	"14.253.16.0/20",
	"14.253.32.0/20",
	"14.253.48.0/20",
	"14.253.64.0/18",
	"14.253.96.0/20",
	"14.253.112.0/20",
	"14.253.118.0/24",
	"14.253.128.0/18",
	"14.253.144.0/20",
	"14.253.160.0/20",
	"14.253.176.0/20",
	"14.253.192.0/18",
	"14.253.208.0/20",
	"14.253.224.0/20",
	"14.254.0.0/16",
	"14.254.8.0/22",
	"14.254.16.0/20",
	"14.254.32.0/19",
	"14.254.48.0/20",
	"14.254.64.0/18",
	"14.254.80.0/20",
	"14.254.96.0/19",
	"14.254.112.0/20",
	"14.254.128.0/18",
	"14.254.144.0/20",
	"14.254.160.0/19",
	"14.254.176.0/20",
	"14.254.192.0/18",
	"14.254.208.0/20",
	"14.254.209.0/24",
	"14.254.210.0/24",
	"14.254.211.0/24",
	"14.254.212.0/24",
	"14.254.213.0/24",
	"14.254.214.0/24",
	"14.254.224.0/19",
	"14.254.240.0/20",
	"14.255.0.0/16",
	"14.255.8.0/24",
	"14.255.9.0/24",
	"14.255.10.0/24",
	"14.255.11.0/24",
	"14.255.12.0/24",
	"14.255.13.0/24",
	"14.255.14.0/24",
	"14.255.15.0/24",
	"14.255.16.0/20",
	"14.255.32.0/20",
	"14.255.48.0/20",
	"14.255.64.0/18",
	"14.255.80.0/20",
	"14.255.96.0/20",
	"14.255.112.0/20",
	"14.255.128.0/18",
	"14.255.144.0/20",
	"14.255.160.0/20",
	"14.255.176.0/20",
	"14.255.192.0/18",
	"14.255.208.0/20",
	"14.255.212.0/24",
	"14.255.213.0/24",
	"14.255.214.0/24",
	"14.255.215.0/24",
	"14.255.216.0/24",
	"14.255.217.0/24",
	"14.255.218.0/24",
	"14.255.219.0/24",
	"14.255.220.0/24",
	"14.255.221.0/24",
	"14.255.222.0/24",
	"14.255.223.0/24",
	"14.255.224.0/20",
	"14.255.225.0/24",
	"14.255.226.0/24",
	"14.255.227.0/24",
	"14.255.228.0/24",
	"14.255.229.0/24",
	"14.255.230.0/24",
	"14.255.231.0/24",
	"14.255.232.0/24",
	"14.255.233.0/24",
	"14.255.234.0/24",
	"14.255.235.0/24",
	"14.255.236.0/24",
	"14.255.237.0/24",
	"14.255.238.0/24",
	"14.255.239.0/24",
	"14.255.240.0/20",
	"14.255.241.0/24",
	"14.255.242.0/24",
	"14.255.243.0/24",
	"14.255.244.0/24",
	"14.255.245.0/24",
	"14.255.246.0/24",
	"14.255.247.0/24",
	"14.255.248.0/24",
	"14.255.249.0/24",
	"14.255.250.0/24",
	"14.255.251.0/24",
	"14.255.252.0/24",
	"14.255.253.0/24",
	"14.255.254.0/24",
];

$expected2 = [
	"14.226.0.0/15",
	"14.228.0.0/14",
	"14.232.0.0/13",
	"14.240.0.0/12",
];

/*
 * Example 3 (IPv6)
 * This large IPv6 list should collapse to 2001:ee0::/31
 * We'll include a representative set from the message including the covering /32s.
 */
$example3 = [
	"2001:ee0:3241::/48",
	"2001:ee0:4c80::/42",
	"2001:ee0:79c0::/42",
	"2001:ee0:5340::/42",
	"2001:ee0:9700::/42",
	"2001:ee0:c800::/42",
	"2001:ee0:5400::/42",
	"2001:ee0:e8c0::/42",
	"2001:ee0:4400::/42",
	"2001:ee1:7e00::/42",
	"2001:ee0:7780::/42",
	"2001:ee0:cd00::/42",
	"2001:ee1:8600::/42",
	"2001:ee0:5740::/42",
	"2001:ee0:f180::/42",
	"2001:ee0:55c0::/42",
	"2001:ee0:7e00::/42",
	"2001:ee1:ee00::/42",
	"2001:ee0:d740::/42",
	"2001:ee0:2f00::/43",
	"2001:ee0:a400::/42",
	"2001:ee0:d500::/42",
	"2001:ee0:180::/42",
	"2001:ee0:7200::/42",
	"2001:ee0:3240::/48",
	"2001:ee0:e5c0::/42",
	"2001:ee0:3206::/48",
	"2001:ee0:4000::/40",
	"2001:ee0:7d40::/42",
	"2001:ee0:7440::/42",
	"2001:ee0:d800::/42",
	"2001:ee0:7900::/42",
	"2001:ee0:3e00::/42",
	"2001:ee0:4e00::/42",
	"2001:ee0:7c80::/42",
	"2001:ee0:322c::/48",
	"2001:ee0:3207::/48",
	"2001:ee0:5180::/42",
	"2001:ee0:4380::/42",
	"2001:ee0:54c0::/42",
	"2001:ee0:7700::/42",
	"2001:ee0:ca00::/42",
	"2001:ee0:eec0::/42",
	"2001:ee0:a700::/42",
	"2001:ee0:5000::/42",
	"2001:ee0:56c0::/42",
	"2001:ee0:322b::/48",
	"2001:ee0:8200::/42",
	"2001:ee1:f700::/42",
	"2001:ee0:4980::/42",
	"2001:ee0:cc00::/42",
	"2001:ee0:3223::/48",
	"2001:ee0:47c0::/42",
	"2001:ee0:324a::/48",
	"2001:ee0:7000::/42",
	"2001:ee0:7280::/42",
	"2001:ee1:e600::/42",
	"2001:ee1:d140::/42",
	"2001:ee0:9b00::/42",
	"2001:ee0:da00::/42",
	"2001:ee0:e2c0::/42",
	"2001:ee0:140::/42",
	"2001:ee0:7dc0::/42",
	"2001:ee0:ec00::/42",
	"2001:ee0:4880::/42",
	"2001:ee0:1a40::/42",
	"2001:ee0:4100::/42",
	"2001:ee0:3201::/48",
	"2001:ee0:d780::/42",
	"2001:ee0:4e40::/42",
	"2001:ee0:1c0::/42",
	"2001:ee0:41c0::/42",
	"2001:ee0:8bc0::/42",
	"2001:ee0:eb00::/42",
	"2001:ee1:db00::/42",
	"2001:ee0:2800::/43",
	"2001:ee0:7400::/42",
	"2001:ee0:4780::/42",
	"2001:ee0:3215::/48",
	"2001:ee0:8e40::/42",
	"2001:ee0:d000::/42",
	"2001:ee0:d9c0::/42",
	"2001:ee0:3700::/42",
	"2001:ee0:280::/42",
	"2001:ee0:cc80::/42",
	"2001:ee0:3225::/48",
	"2001:ee0:b000::/40",
	"2001:ee0:75c0::/42",
	"2001:ee0:4300::/42",
	"2001:ee0:7b00::/42",
	"2001:ee0:e800::/42",
	"2001:ee1:f100::/42",
	"2001:ee0:b000::/42",
	"2001:ee0:e840::/42",
	"2001:ee0:4040::/42",
	"2001:ee0::/32",
	"2001:ee0:9c00::/42",
	"2001:ee0:4700::/42",
	"2001:ee0:d700::/42",
	"2001:ee0:e6c0::/42",
	"2001:ee0:7bc0::/42",
	"2001:ee0:5580::/42",
	"2001:ee0:3209::/48",
	"2001:ee0:2f40::/43",
	"2001:ee0:8e00::/42",
	"2001:ee0:4d00::/42",
	"2001:ee0:c600::/42",
	"2001:ee0:4d80::/42",
	"2001:ee0:8100::/40",
	"2001:ee0:3280::/48",
	"2001:ee0:4180::/42",
	"2001:ee0:9600::/42",
	"2001:ee0:d200::/42",
	"2001:ee0:4bc0::/42",
	"2001:ee0:da80::/42",
	"2001:ee0:43c0::/42",
	"2001:ee0:de00::/42",
	"2001:ee0:3229::/48",
	"2001:ee0:3221::/48",
	"2001:ee1:7c00::/42",
	"2001:ee0:44c0::/42",
	"2001:ee0:e9c0::/42",
	"2001:ee0:240::/42",
	"2001:ee0:dd00::/42",
	"2001:ee0:7e40::/42",
	"2001:ee0:4c00::/42",
	"2001:ee0:3213::/48",
	"2001:ee0:7680::/42",
	"2001:ee0:5500::/42",
	"2001:ee0:d7c0::/42",
	"2001:ee0:4cc0::/42",
	"2001:ee0:1006::/48",
	"2001:ee0:50c0::/42",
	"2001:ee0:5040::/42",
	"2001:ee0:7c00::/42",
	"2001:ee0:2c0::/42",
	"2001:ee0:2801::/48",
	"2001:ee1:b600::/42",
	"2001:ee0:5280::/42",
	"2001:ee0:4440::/42",
	"2001:ee0:9900::/42",
	"2001:ee0:4240::/42",
	"2001:ee0:dc80::/42",
	"2001:ee0:7880::/42",
	"2001:ee0:d400::/42",
	"2001:ee0:4140::/42",
	"2001:ee0:76c0::/42",
	"2001:ee0:322a::/48",
	"2001:ee0:e0c0::/42",
	"2001:ee0:2f00::/48",
	"2001:ee0:5140::/42",
	"2001:ee1:e400::/42",
	"2001:ee0:5100::/42",
	"2001:ee0:c100::/42",
	"2001:ee0:f040::/42",
	"2001:ee0:4a80::/42",
	"2001:ee0:7580::/42",
	"2001:ee0:4540::/42",
	"2001:ee0:dac0::/42",
	"2001:ee0:4e80::/42",
	"2001:ee0:ce00::/42",
	"2001:ee0:4080::/42",
	"2001:ee1:e800::/42",
	"2001:ee0:5200::/42",
	"2001:ee0:5600::/42",
	"2001:ee0:dd40::/42",
	"2001:ee0:72c0::/42",
	"2001:ee1:80c0::/42",
	"2001:ee0:d900::/42",
	"2001:ee0:c400::/42",
	"2001:ee1:fc00::/42",
	"2001:ee0:3200::/42",
	"2001:ee0:5480::/42",
	"2001:ee0:48c0::/42",
	"2001:ee0:4600::/42",
	"2001:ee0:eac0::/42",
	"2001:ee0:7500::/42",
	"2001:ee0:7c40::/42",
	"2001:ee0:4840::/42",
	"2001:ee0:7640::/42",
	"2001:ee0:3210::/48",
	"2001:ee0:4940::/42",
	"2001:ee0:5540::/42",
	"2001:ee1:df00::/42",
	"2001:ee0:4dc0::/42",
	"2001:ee0:400::/42",
	"2001:ee0:3222::/48",
	"2001:ee0:1a00::/42",
	"2001:ee0:40c0::/42",
	"2001:ee0:78c0::/42",
	"2001:ee0:4640::/42",
	"2001:ee0:4b40::/42",
	"2001:ee1:fa00::/42",
	"2001:ee1:d100::/42",
	"2001:ee0:3204::/48",
	"2001:ee1:f400::/42",
	"2001:ee0:cb00::/42",
	"2001:ee0:4800::/42",
	"2001:ee0:4f00::/42",
	"2001:ee0:e200::/42",
	"2001:ee0:e1c0::/42",
	"2001:ee0:dfc0::/42",
	"2001:ee0:2f06::/48",
	"2001:ee0:dec0::/42",
	"2001:ee0:db00::/42",
	"2001:ee1:b5c0::/42",
	"2001:ee0:4f80::/42",
	"2001:ee0:4340::/42",
	"2001:ee0:e000::/42",
	"2001:ee0:4000::/42",
	"2001:ee0:f0c0::/42",
	"2001:ee0:74c0::/42",
	"2001:ee0:3000::/48",
	"2001:ee1:d700::/42",
	"2001:ee0:5640::/42",
	"2001:ee1:ec00::/42",
	"2001:ee0:7300::/42",
	"2001:ee0:53c0::/42",
	"2001:ee0:9c40::/42",
	"2001:ee0:5080::/42",
	"2001:ee0:ebc0::/42",
	"2001:ee0:300d::/48",
	"2001:ee0:3280::/42",
	"2001:ee0:8700::/40",
	"2001:ee0:3220::/48",
	"2001:ee1:c000::/42",
	"2001:ee0:edc0::/42",
	"2001:ee0:7340::/42",
	"2001:ee0:77c0::/42",
	"2001:ee0:4b80::/42",
	"2001:ee0:46c0::/42",
	"2001:ee0:4c40::/42",
	"2001:ee0:7800::/42",
	"2001:ee0:4900::/42",
	"2001:ee0:4a00::/42",
	"2001:ee1:7c40::/42",
	"2001:ee0:7840::/42",
	"2001:ee0:9100::/40",
	"2001:ee1:9100::/42",
	"2001:ee0:e4c0::/42",
	"2001:ee0:9800::/42",
	"2001:ee0:4740::/42",
	"2001:ee0:32c0::/42",
	"2001:ee0:9400::/42",
	"2001:ee0:3212::/48",
	"2001:ee0:c900::/42",
	"2001:ee0:4480::/42",
	"2001:ee0:51c0::/42",
	"2001:ee0:a200::/42",
	"2001:ee0:5300::/42",
	"2001:ee0:4d40::/42",
	"2001:ee0:7940::/42",
	"2001:ee0:9f00::/42",
	"2001:ee0:d100::/42",
	"2001:ee0:3100::/48",
	"2001:ee0:5240::/42",
	"2001:ee0:3203::/48",
	"2001:ee0:2f20::/43",
	"2001:ee0:45c0::/42",
	"2001:ee0:4a40::/42",
	"2001:ee0:8900::/42",
	"2001:ee0:7d80::/42",
	"2001:ee0:42c0::/42",
	"2001:ee0:9200::/42",
	"2001:ee0:49c0::/42",
	"2001:ee0:ddc0::/42",
	"2001:ee0:3281::/48",
	"2001:ee0:a100::/42",
	"2001:ee0:7b80::/42",
	"2001:ee0:3205::/48",
	"2001:ee0:9500::/42",
	"2001:ee0:a500::/42",
	"2001:ee0:2f07::/48",
	"2001:ee0:7480::/42",
	"2001:ee0:73c0::/42",
	"2001:ee0:8200::/40",
	"2001:ee0:52c0::/42",
	"2001:ee0:3000::/43",
	"2001:ee0:4580::/42",
	"2001:ee0:9100::/42",
	"2001:ee0:d300::/42",
	"2001:ee0:ec80::/42",
	"2001:ee0:8000::/42",
	"2001:ee0:efc0::/42",
	"2001:ee0:4f40::/42",
	"2001:ee0:8000::/40",
	"2001:ee0:7240::/42",
	"2001:ee0:7980::/42",
	"2001:ee0:200::/42",
	"2001:ee0:3214::/48",
	"2001:ee0:5380::/42",
	"2001:ee0:d8c0::/42",
	"2001:ee0:7e80::/42",
	"2001:ee1:c040::/42",
	"2001:ee0:300a::/48",
	"2001:ee0:5680::/42",
	"2001:ee0:f080::/42",
	"2001:ee0:ecc0::/42",
	"2001:ee0:8100::/42",
	"2001:ee0:1a80::/42",
	"2001:ee0:4200::/42",
	"2001:ee0:e400::/42",
	"2001:ee0:ee00::/42",
	"2001:ee0:f1c0::/42",
	"2001:ee0:5700::/42",
	"2001:ee0:3100::/43",
	"2001:ee0:8700::/42",
	"2001:ee0:9200::/40",
	"2001:ee0:c500::/42",
	"2001:ee0:4500::/42",
	"2001:ee0:5440::/42",
	"2001:ee0:4fc0::/42",
	"2001:ee0:a240::/42",
	"2001:ee0:4ec0::/42",
	"2001:ee0:4280::/42",
	"2001:ee0:4b00::/42",
	"2001:ee0:3211::/48",
	"2001:ee1:fa40::/42",
	"2001:ee0:100::/42",
	"2001:ee0:3202::/48",
	"2001:ee1::/32",
	"2001:ee0:c300::/42",
	"2001:ee0:7d00::/42",
	"2001:ee0:7cc0::/42",
	"2001:ee0:dcc0::/42",
	"2001:ee0:3224::/48",
	"2001:ee0:3240::/42",
	"2001:ee0:ff80::/42",
	"2001:ee0:4680::/42",
	"2001:ee0:c200::/42",
	"2001:ee0:8d00::/42",
];

$expected3 = ["2001:ee0::/31"];

$all_ok = true;
$all_ok &= run_test('example1', $example1, $expected1);
$all_ok &= run_test('example2', $example2, $expected2);
$all_ok &= run_test('example3', $example3, $expected3);

if (!$all_ok) {
	echo "One or more tests failed\n";
	exit(1);
}

echo "All tests passed\n";
exit(0);
?>